### 时间戳生成

采用 Java 内置的 `SimpleDateFormat` 格式化当前时间，格式为 `"yyyyMMddHHmmssSSS"`：
- `yyyy` 表示年份
- `MM` 表示月份
- `dd` 表示日期
- `HH` 表示小时（24小时制）
- `mm` 表示分钟
- `ss` 表示秒
- `SSS` 表示毫秒

这种格式能确保在大部分情况下生成的时间戳唯一，并具有时间顺序性。例如，`20250217123045123` 表示 2025-02-17 12:30:45.123。

### 文件ID生成逻辑

生成文件ID的步骤如下：

1. **获取文档类型缩写**  
   根据传入的文档类型ID调用映射方法得到对应的缩写字符串（如 "MPR"）。

2. **生成时间戳**  
   使用 `SimpleDateFormat("yyyyMMddHHmmssSSS")` 获取当前时间的字符串表示，确保精确到毫秒。

3. **拼接生成文件ID**  
   将文档类型缩写与时间戳拼接，形成最终文件ID。例如：
   ```java
   String fileID = abbreviation + timestamp;
   ```
   其中 `abbreviation` 为文档类型缩写，`timestamp` 为生成的时间戳字符串。


下面给出补全后的两张表格。第一张是完整的【文档类型对照表】，第二张是各上传系统与文档类型的映射关系表。

---

### 文档类型对照表

| 文档类型ID | 文档类型名称（英文）                       | 缩写  | 备注说明     |
|--------|----------------------------------|-----|----------|
| 1      | Material Physicochemical Report  | MPR | 材质理化报告   |
| 2      | Certificate                      | CER | 合格证      |
| 3      | Manual                           | MAN | 说明书      |
| 4      | Product Inspection Report        | PIR | 产品检验报告   |
| 5      | Packing List                     | PL  | 装箱单      |
| 6      | Supplier Raw Material Report     | SRM | 供应商原材料报告 |
| 7      | Packing Photo                    | PP  | 装箱单照片    |
| 8      | Welding Report                   | WR  | 焊接报告     |
| 9      | Part Dimension Record Report     | PDR | 零件尺寸记录报告 |
| 10     | Heat Treatment Report            | HTR | 热处理报告    |
| 11     | Spraying Report                  | SPR | 喷涂报告     |
| 12     | Spray Welding Report             | SWR | 喷焊报告     |
| 13     | Marking                          | MM  | 唛头       |
| 15     | Pneumatic Circuit Diagram        | PCD | 气路图      |
| 16     | Exterior Dimension Drawing       | EDD | 外形尺寸图    |
| 17     | Calculation Report               | CAL | 计算书      |
| 18     | Supplier Raw Material Attachment | SRA | 供应商原材料附件 |

---

### 上传系统与文档类型映射关系

| 上传系统 | DocumentTypeName | MatchID | 产品分类         | 文件数量 | PlanTrackingNumber | DocumentTypeID | 文档类型名称（英文）                       | 缩写  |
|------|------------------|---------|--------------|------|--------------------|----------------|----------------------------------|-----|
| MOM  | 装箱单              | 产品编号    | 产品           | 多个   | 箱号                 | 5              | Packing List                     | PL  |
| MOM  | 唛头               | 产品编号    | 产品           | 单个   | 产品编号               | 13             | Marking                          | MM  |
| MOM  | 合格证              | 产品编号    | 产品           | 单个   | 产品编号               | 2              | Certificate                      | CER |
| MOM  | 产品检验报告           | 产品编号    | 产品           | 单个   | 产品编号               | 4              | Product Inspection Report        | PIR |
| MOM  | 焊接报告             | 序列号     | 原材料          | 单个   | 序列号                | 8              | Welding Report                   | WR  |
| MOM  | 零件尺寸记录报告         | 序列号     | 原材料          | 单个   | 序列号                | 9              | Part Dimension Record Report     | PDR |
| MOM  | 热处理报告            | 序列号     | 原材料          | 单个   | 序列号                | 10             | Heat Treatment Report            | HTR |
| MOM  | 喷涂报告             | 序列号     | 原材料          | 单个   | 序列号                | 11             | Spraying Report                  | SPR |
| MOM  | 喷焊报告             | 序列号     | 原材料          | 单个   | 序列号                | 12             | Spray Welding Report             | SWR |
| 质量平台 | 材质理化报告           | 炉号      | 原材料（以炉号为原材料） | 单个   | 炉号                 | 1              | Material Physicochemical Report  | MPR |
| 质量平台 | 供应商原材料附件         | 原材料     | 质量平台         | 多个   |                    | 18             | Supplier Raw Material Attachment | SRA |

---

这样，不论是通过 `switch` 语句还是利用 `Map<Integer, String>` 来映射，都可以根据文档类型ID获得相应的缩写。如果传入的ID不在上表中，则返回 "UNK"（未知）。



映射关系可以通过 `switch` 语句或者映射表（例如 `Map<Integer, String>`）来实现。如果传入的文档类型ID不存在对应的映射，则默认返回 "UNK"（未知）。

| 上传系统 | DocumentTypeName | MatchID | 产品分类         | 文件数量 | PlanTrackingNumber | DocumentTypeID | 文档类型名称（英文）                      | 缩写  |
|------|------------------|---------|--------------|------|--------------------|----------------|---------------------------------|-----|
| MOM  | 装箱单              | 产品编号    | 产品           | 多个   | 箱号                 | 5              | Packing List                    | PL  |
| MOM  | 唛头               | 产品编号    | 产品           | 单个   | 产品编号               | 13             | Marking                         | MM  |
| MOM  | 合格证              | 产品编号    | 产品           | 单个   | 产品编号               | 2              | Certificate                     | CER |
| MOM  | 产品检验报告           | 产品编号    | 产品           | 单个   | 产品编号               | 4              | Product Inspection Report       | PIR |
| MOM  | 焊接报告             | 序列号     | 原材料          | 单个   | 序列号                | 8              | Welding Report                  | WR  |
| MOM  | 零件尺寸记录报告         | 序列号     | 原材料          | 单个   | 序列号                | 9              | Part Dimension Record Report    | PDR |
| MOM  | 热处理报告            | 序列号     | 原材料          | 单个   | 序列号                | 10             | Heat Treatment Report           | HTR |
| MOM  | 喷涂报告             | 序列号     | 原材料          | 单个   | 序列号                | 11             | Spraying Report                 | SPR |
| MOM  | 喷焊报告             | 序列号     | 原材料          | 单个   | 序列号                | 12             | Spray Welding Report            | SWR |
| 视频平台 | 视频压缩文件           | 产品编号    | 产品           | 多个   | 产品编号               |                |                                 |     |
| 质量平台 | 材质理化报告           | 炉号      | 原材料（以炉号为原材料） | 单个   | 炉号                 | 1              | Material Physicochemical Report | MPR |
| 质量平台 | 供应商原材料附件         | 原材料     | 质量平台         | 多个   |                    |                |                                 |     |

### 注意事项

1. **PlanTrackingNumber**:
   MatchID与PlanTrackingNumber不统一的时候才填写PlanTrackingNumber

2. **错误处理**:  
   对于上传接口，若缺少必填参数（例如 `matchID` 或 `DocumentTypeID`），或上传的文件为空，将返回错误提示。

3. **文件格式转换**:  
   上传接口支持将非 PDF 文件转换为 PDF，转换失败时会返回相应错误信息。

4. **查询接口**:  
   批量查询接口要求至少提供 `matchID` 或 `documentTypeID` 中的一个参数，接口将根据传入的参数返回对应的文件ID集合。

---


### 1. **直接上传文件接口**

- **路径**:  
  `http://10.11.0.20:8088/fms/ftp/upload`

- **请求方法**:  
  `POST`

- **请求参数**:
  - **file** (必填): 上传的文件，类型为 `MultipartFile`。
  - **DocumentTypeID** (必填): 文档类型ID，类型为 `Integer`。例如：1 表示“Material Physicochemical Report”，2 表示“Certificate”等。
  - **matchID** (必填): 匹配ID，类型为 `String`，用于标识文件所属的匹配记录。
  - **PlanTrackingNumber** (选填): 计划跟踪号，类型为 `String`，用于标识计划的编号。
  - **createdBy** (必填): 创建人，类型为 `String`，记录上传该文件的用户。
    
- **请求示例**:
    ```bash
    curl -X POST http://10.11.0.20:8088/fms/ftp/upload \
      -F "file=@/path/to/file.pdf" \
      -F "DocumentTypeID=1" \
      -F "matchID=12345" \
      -F "createdBy=admin"
    ```

- **响应示例**:
  - **成功** (HTTP 200):
    ```json
    {
      "code": 200,
      "msg": "文件上传成功并已存储到数据库",
      "data": "MAN20250218155312030"
    }
    ```
  - **失败** (HTTP 500):
    ```json
    {
      "code": 500,
      "msg": "上传的文件为空"
    }
    ```

- **注意**:
  - **文件名要求**: 目前接口不支持上传文件名中包含中文字符或空格，请确保上传的文件名仅由英文字符、数字、下划线、连字符等合法字符组成。

- **描述**:  
  用于直接上传文件，不进行格式转换。上传后将文件存储到服务器的指定目录，并在数据库中记录相关信息（包括文件ID、文件名、匹配ID、文档类型等）。

---

### 2. **上传文件后转换为 PDF 接口**

- **路径**:  
  `http://10.11.0.20:8088/fms/ftp/uploadToPdf`

- **请求方法**:  
  `POST`

- **请求参数**:
  - **file** (必填): 上传的文件，类型为 `MultipartFile`。
  - **DocumentTypeID** (必填): 文档类型ID，类型为 `Integer`。
  - **matchID** (必填): 匹配ID，类型为 `String`。
  - **PlanTrackingNumber** (选填): 计划跟踪号，类型为 `String`。
  - **createdBy** (必填): 创建人，类型为 `String`。

- **请求示例**:
    ```bash
    curl -X POST http://10.11.0.20:8088/fms/ftp/uploadToPdf \
      -F "file=@/path/to/file.docx" \
      -F "DocumentTypeID=1" \
      -F "matchID=12345" \
      -F "createdBy=admin"
    ```

- **响应示例**:
  - **成功** (HTTP 200):
    ```json
    {
      "code": 200,
      "msg": "文件上传成功并已存储到数据库",
      "data": "MAN20250218155312031"
    }
    ``` 
  - **失败** (HTTP 500):
    ```json
    {
      "code": 500,
      "msg": "文件转换为 PDF 失败"
    }
    ```

- **注意**:
  - **文件名要求**: 上传文件名中不能包含中文字符或空格，请使用合法的英文文件名。

- **描述**:  
  用于上传文件并将其转换为 PDF 格式。适用于上传的原始文件为非 PDF 格式（例如 Word、Excel），系统会先保存文件至临时目录，再转换为 PDF 文件上传，并在数据库中记录转换后的文件信息。

---

### 3. **下载文件接口**

- **路径**:  
  `http://10.11.0.20:8088/fms/ftp/download`

- **请求方法**:  
  `GET`

- **请求参数**:
  - **fileId** (必填): 文件ID，类型为 `String`。通过文件ID在数据库中查找对应的文件路径。

- **请求示例**:
    ```bash
    curl -X GET "http://10.11.0.20:8088/fms/ftp/download?fileId=MAN20250218155312030"
    ```

- **响应示例**:
  - **成功**:  
    返回文件内容，用户可直接下载文件。
  - **失败** (HTTP 404):
    ```json
    {
      "code": 404,
      "msg": "文件未找到"
    }
    ```

- **描述**:  
  根据提供的 `fileId` 从服务器下载文件。如果文件不存在，则返回 404 状态码。

---

### 4. **在线预览文件接口**

- **路径**:  
  `http://10.11.0.20:8088/fms/ftp/preview`

- **请求方法**:  
  `GET`

- **请求参数**:
  - **fileId** (必填): 文件ID，类型为 `String`。用于从数据库中查找对应的文件路径。

- **请求示例**:
    ```bash
    curl -X GET "http://10.11.0.20:8088/fms/ftp/preview?fileId=MAN20250218155312030"
    ```

- **响应示例**:
  - **成功**:  
    返回文件内容，直接在浏览器中预览文件（适用于 PDF、图片等格式）。
  - **失败** (HTTP 404):
    ```json
    {
      "code": 404,
      "msg": "文件未找到"
    }
    ```

- **描述**:  
  根据 `fileId` 实现在线预览文件。适用于用户在浏览器中直接查看文件内容。

---

以下是补充的更新文档，添加了对 `PlanTrackingNumber` 参数的支持以及根据 `matchID` 和 `documentTypeID` 查询文件ID集合的接口信息。

---

### 5. **根据 `matchID` 和 `documentTypeID` 查询文件ID集合接口**

- **路径**:  
  `http://10.11.0.20:8088/fms/ftp/getFileIDs`

- **请求方法**:  
  `GET`

- **请求参数**:
  - **matchID** (选填): 匹配ID，类型为 `String`。可单独用于查询文件。
  - **documentTypeID** (选填): 文档类型ID，类型为 `Integer`。可单独用于查询文件。
  - **PlanTrackingNumber** (选填): 计划跟踪编号，类型为 `String`。如果提供此参数，必须同时提供 `matchID`。

  **说明**: 至少必须提供其中一个参数。如果同时提供 `PlanTrackingNumber`，必须同时提供 `matchID`。

- **请求示例**:
  - 仅使用 `matchID`:
    ```bash
    curl -X GET "http://10.11.0.20:8088/fms/ftp/getFileIDs?matchID=12345"
    ```
  - 仅使用 `documentTypeID`:
    ```bash
    curl -X GET "http://10.11.0.20:8088/fms/ftp/getFileIDs?documentTypeID=1"
    ```
  - 同时使用 `matchID` 和 `documentTypeID`:
    ```bash
    curl -X GET "http://10.11.0.20:8088/fms/ftp/getFileIDs?matchID=12345&documentTypeID=1"
    ```
  - 同时使用 `matchID` 和 `PlanTrackingNumber`:
    ```bash
    curl -X GET "http://10.11.0.20:8088/fms/ftp/getFileIDs?matchID=12345&PlanTrackingNumber=PN12345"
    ```

- **响应示例** (成功):
    ```json
    {
        "code": 200,
        "msg": "查询成功",
        "data": [
            {
                "documentTypeID": 2,
                "fileID": "CER20250219092459250"
            },
            {
                "documentTypeID": 2,
                "fileID": "CER20250219092506125"
            },
            {
                "documentTypeID": 3,
                "fileID": "MAN20250218152236684"
            },
            {
                "documentTypeID": 3,
                "fileID": "MAN20250218161240955"
            }
        ]
    }
    ```

- **响应示例** (失败):
    ```json
    {
        "code": 500,
        "msg": "查询文件ID失败"
    }
    ```

- **描述**:  
  根据提供的 `matchID` 和/或 `documentTypeID` 查询文件ID集合。至少必须提供其中一个参数。如果同时提供，则返回同时匹配的结果；否则，根据单一参数进行查询。如果提供了 `PlanTrackingNumber` 参数，则必须同时提供 `matchID`。

---

### 6. **批量查询文件ID集合接口**

**接口描述**:  
根据传入的匹配ID (`matchID`) 与文档类型ID集合 (`documentTypeIDs`)，批量查询对应的文件ID集合。  
返回结果为数组，每个对象包含对应的 `documentTypeID` 及查询到的 `fileID`。

---

**请求路径**:  
`http://10.11.0.20:8088/fms/ftp/batchGetFileIDs`

**请求方法**:  
`GET`

**请求参数**:

| 参数名称                 | 类型              | 必填 | 说明                               | 示例        |
|----------------------|-----------------|----|----------------------------------|-----------|
| `matchID`            | `String`        | 是  | 匹配ID，用于标识文件所属的匹配记录               | `"12345"` |
| `documentTypeIDs`    | `List<Integer>` | 是  | 文档类型ID集合，可传入多个，用英文逗号分隔（例如：1,2,3） | `1,2,3`   |
| `PlanTrackingNumber` | `String`        | 否  | 可选的计划跟踪编号，传入时必须同时提供 `matchID`    | `PN12345` |

**请求示例**:
- 通过浏览器或 curl 请求示例：
  ```bash
  curl -X GET "http://10.11.0.20:8088/fms/ftp/batchGetFileIDs?matchID=12345&documentTypeIDs=1,2,3&PlanTrackingNumber=PN12345"
  ```

---

**响应示例**:

- **成功时** (HTTP 200):
  ```json
  {
      "code": 200,
      "msg": "操作成功",
      "data": [
          { "documentTypeID": 2, "fileID": "12212" },
          { "documentTypeID": 3, "fileID": "12213" }
      ]
  }
  ```

- **失败时** (HTTP 500):
  ```json
  {
      "code": 500,
      "msg": "批量查询文件ID失败",
      "data": "<错误信息>"
  }
  ```

---

**返回字段说明**:

- **code**: 状态码，`200` 表示成功，`500` 表示失败。
- **msg**: 操作描述信息。
- **data**: 返回的文件ID集合数据，格式为数组。  
  每个数组项为一个 JSON 对象，其中包含：
  - `documentTypeID`: 文档类型ID，对应查询条件中的一个文档类型。
  - `fileID`: 查询到的文件ID。

---

**参数校验**:
- 接口要求必须提供 `matchID`，且不能为空字符串。
- `documentTypeIDs` 集合也必须不为空，至少包含一个文档类型ID。

---

**错误提示**:
- 如果未提供 `matchID` 或 `documentTypeIDs`，接口将返回错误提示：
  ```json
  {
      "code": 500,
      "msg": "必须提供 matchID 和至少一个 documentTypeID"
  }
  ```
- 如果查询过程中发生异常，将返回 `"批量查询文件ID失败"` 及异常信息。

---

**说明**:
- 该接口通过 GET 请求接收参数，适用于批量查询文件ID集合。
- 服务器端会根据传入的 `matchID` 和 `documentTypeIDs` 调用业务层方法查询数据，并返回查询结果。
- 返回数据中，每个对象表示某一文档类型对应的一个文件ID。若某个文档类型有多个文件记录，则返回的数组中可能包含多个对象，其 `documentTypeID` 值相同但 `fileID` 不同。


---

