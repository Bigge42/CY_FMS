下面提供一个 Postman 调用文档示例，用于测试该 FTP 文件管理接口。你可以将下面的内容导入 Postman 或参考示例进行接口测试。

---

# FTP 接口 Postman 调用文档

该文档介绍了三个接口：文件上传、文件下载、文件删除。

接口基础 URL（示例）：
```
http://localhost:8080/fms/ftp
```  
*注：请根据实际部署地址修改基础 URL。*

---

## 1. 文件上传接口

**接口描述**  
上传文件到 FTP，并将文件记录存储到数据库。支持的文档类型（示例）包括：
- 材质理化报告
- 合格证
- 说明书
- 产品检验报告
- 装箱单
- 供应商原材料报告
- abc

**请求 URL**
```
[POST] http://localhost:8080/fms/ftp/upload
```

**请求参数**

| 参数名             | 类型         | 必填 | 说明                                                         |
|------------------|------------|-----|------------------------------------------------------------|
| file             | File       | 是  | 要上传的文件。使用 form-data 的 file 类型。                     |
| documentTypeName | String     | 是  | 文档类型名称（请确保传入允许的类型之一，否则返回错误信息）。     |
| matchID          | Integer    | 是  | 匹配 ID，用于唯一标识该文件记录。                               |

**Postman 配置示例**
- 选择 `Body` → `form-data`
- 添加以下三个 key：

  | Key                | Type      | Value                             |
    |-------------------|-----------|-----------------------------------|
  | file              | File      | （选择本地文件）                   |
  | documentTypeName  | Text      | 合格证 （示例值，必须在允许列表中） |
  | matchID           | Text      | 123 （示例值）                     |

**请求示例**  
在 Postman 中配置完毕后，发送请求。如果上传成功，将返回类似下面的 JSON 响应：

```json
{
  "code": 200,
  "msg": "文件上传成功并已存储到数据库",
  "url": "ftp://yourftpserver/path/to/uploaded/file_newFileName.ext"
}
```

如果上传失败，则返回类似的错误信息：

```json
{
  "code": 500,
  "msg": "不支持的文档类型: xxx"
}
```

---

## 2. 文件下载接口

**接口描述**  
根据文档类型名称和 matchID 查找文件记录并从 FTP 下载对应文件到本地临时目录。

**请求 URL**
```
[GET] http://localhost:8080/fms/ftp/download
```

**请求参数（Query 参数）**

| 参数名             | 类型      | 必填 | 说明                                              |
|------------------|---------|-----|-------------------------------------------------|
| documentTypeName | String  | 是  | 文档类型名称（或作为标识文件的名称）              |
| matchID          | Integer | 是  | 匹配 ID，用于查找对应的文件记录。                    |

**请求示例**  
在 Postman 的 Params 面板中添加两个参数：
- documentTypeName：合格证
- matchID：123

发送请求后，如果查找和下载成功，将返回类似下面的 JSON 响应：

```json
{
  "code": 200,
  "msg": "文件下载成功，保存到: /temp/dir/合格证_20250113123045.ext"
}
```

如果未找到文件或下载失败，则返回错误信息，例如：

```json
{
  "code": 500,
  "msg": "未找到对应的文件记录"
}
```

---

## 3. 文件删除接口

**接口描述**  
根据文件名和 matchID 查找文件记录，从 FTP 删除对应文件，并将数据库记录标记为已删除。

**请求 URL**
```
[DELETE] http://localhost:8080/fms/ftp/delete
```

**请求参数（Query 参数）**

| 参数名    | 类型      | 必填 | 说明                                          |
|---------|---------|-----|---------------------------------------------|
| fileName | String  | 是  | 文件名（文档类型名称+文件名，需与数据库中记录匹配）。 |
| matchID  | Integer | 是  | 匹配 ID，用于查找文件记录。                      |

**请求示例**  
在 Postman 的 Params 面板中添加：
- fileName：合格证.ext （示例值，需与上传时记录一致）
- matchID：123

发送请求后，如果删除成功，将返回类似下面的响应：

```json
{
  "code": 200,
  "msg": "文件删除成功"
}
```

若操作失败，则返回错误信息，例如：

```json
{
  "code": 500,
  "msg": "文件删除失败"
}
```

---

## 附加说明

1. **响应格式**  
   所有接口均使用统一格式返回数据，字段说明：
    - `code`：状态码，200 表示成功，500 表示失败。
    - `msg`：提示信息，描述操作结果。
    - `url`：仅在上传成功时返回，表示文件的访问 URL。

2. **身份校验**  
   接口上标记 `@Anonymous`，表示无需登录即可访问。如果项目后续加入鉴权，请确保修改对应配置。

3. **临时目录**  
   文件上传和下载接口会使用一个临时目录（由 `ftpService.getTempDir()` 返回）保存临时文件，请确保该目录有写权限，并按实际情况清理临时文件。

4. **FTP 配置**  
   上传、下载和删除文件依赖 FTP 服务相关配置。测试时请确保 FTP 服务已启动，相关参数（如 `remoteFolderPath`、FTP URL 等）正确配置。

---
