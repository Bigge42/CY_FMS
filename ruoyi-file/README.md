
---

## **一、文件上传功能**

### 1. **接口说明**
- **URL**：`http://localhost:8088/fms/ftp/upload`
- **方法**：`POST`
- **参数**：
    - `file`：通过 `form-data` 上传的文件。
- **响应**：
    - 成功时返回：`{"code": 200, "msg": "文件上传成功"}`
    - 失败时返回：`{"code": 500, "msg": "文件上传失败: <具体错误信息>"}`

---


### 2. **Postman 测试配置**

#### 配置步骤：
1. **Method**：选择 `POST`。
2. **URL**：输入接口地址：`http://localhost:8088/fms/ftp/upload`。
3. **Body**：
    - 选择 **form-data**。
    - 添加字段：
        - **Key**：`file`
        - **Value**：选择类型为 **File**，然后选择实际文件（如 `test.txt`）。
4. **发送请求**：
    - 点击 **Send**，观察响应。

#### 成功响应示例：
```json
{
    "code": 200,
    "msg": "文件上传成功"
}
```

---

## **二、文件下载功能**

### 1. **接口说明**
- **URL**：`http://localhost:8088/fms/ftp/download`
- **方法**：`GET`
- **参数**：
    - `fileName`：要下载的文件名。
- **响应**：
    - 成功时返回：文件内容作为 `application/octet-stream`。
    - 文件不存在时返回：`{"code": 404, "msg": "文件不存在: <文件名>"}`

---


### 2. **Postman 测试配置**

#### 配置步骤：
1. **Method**：选择 `GET`。
2. **URL**：输入接口地址：`http://localhost:8088/fms/ftp/download?fileName=test.txt`。
3. **Params**：
    - 添加参数：
        - **Key**：`fileName`
        - **Value**：`test.txt`
4. **发送请求**：
    - 点击 **Send**，观察响应。

#### 成功响应：
- 如果 Postman 显示为二进制流，可以点击右下角的 **Save Response** 按钮，保存文件到本地。


---

## **三、常见问题排查**

### 文件上传
1. **错误：`Current request is not a multipart request`**
    - 确认 Postman 的 Body 类型为 **form-data**，并选择文件类型。

2. **文件未保存到临时路径**
    - 检查路径 `C:/temp/` 是否存在，如果不存在会导致保存失败。
    - 后端日志中检查文件路径是否正确。

3. **上传文件到 FTP 失败**
    - 检查 FTP 服务器的配置是否正确。
    - 确认 FTP 的用户名和密码是否有写入权限。

---

### 文件下载
1. **错误：文件不存在**
    - 确认路径 `C:/temp/` 下是否存在指定的文件。
    - 如果文件已经上传到 FTP 服务器，但未同步到本地临时路径，检查 `ftpService.downloadFile` 方法是否正常工作。

2. **文件内容损坏**
    - 确保文件以 `application/octet-stream` 格式返回。
    - 验证文件内容是否正确读取和写入。

---

## **五、测试环境配置**

### 1. Spring Boot 配置   
在 `application.yml` 中配置文件上传限制：
```yaml
spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
```

### 2. FTP 服务配置
- 确保 FTP 服务正常运行，并有正确的权限配置。
- 测试 FTP 上传和下载功能是否正常。


在Windows服务器上搭建FTP服务可以通过多种方式实现，其中使用IIS（Internet Information Services）是最常见的方法之一。以下是使用IIS在Windows服务器上搭建FTP服务器的详细步骤：

### 一、安装IIS及FTP服务组件

1. **打开“服务器管理器”**
    - 点击任务栏中的“服务器管理器”图标，或通过“开始”菜单搜索并打开。

2. **添加角色和功能**
    - 在“服务器管理器”中，点击左侧的“管理”菜单，选择“添加角色和功能”。

3. **启动向导**
    - 在“添加角色和功能向导”中，点击“下一步”直到到达“服务器角色”页面。

4. **选择Web服务器（IIS）角色**
    - 勾选“Web 服务器（IIS）”，系统会提示添加相关功能，点击“添加功能”。

5. **选择FTP相关功能**
    - 展开“Web 服务器（IIS）” > “FTP服务器”，勾选“FTP服务”和“FTP扩展性”。

6. **完成安装**
    - 点击“下一步”直到结束，点击“安装”开始安装过程。安装完成后，点击“关闭”。

### 二、配置FTP站点

1. **打开IIS管理器**
    - 通过“开始”菜单搜索“IIS管理器”或在“服务器管理器”中选择“IIS管理器”。

2. **添加FTP站点**
    - 在IIS管理器的左侧连接栏中，右键点击“网站”，选择“添加FTP站点”。

3. **配置FTP站点信息**
    - **FTP站点名称**：为你的FTP站点命名，例如“Default FTP Site”。
    - **物理路径**：选择用于存放FTP文件的文件夹路径，例如`C:\FTP`。确保该文件夹已存在，并设置适当的权限。

4. **配置绑定和SSL**
    - **IP地址**：选择服务器的IP地址，或者选择“All Unassigned”以接受所有IP。
    - **端口**：默认是21，可以根据需要更改。
    - **SSL**：如果需要加密传输，选择“Require SSL”。如果只是测试，可以选择“不使用SSL”。

5. **设置身份验证和授权**
    - **身份验证**：选择“基本”身份验证。
    - **授权**：
        - **指定访问权限的用户**：可以选择“指定的用户”，输入允许访问的用户名，或选择“所有用户”。
        - **权限**：勾选“读取”和“写入”权限，根据需要选择。

6. **完成FTP站点创建**
    - 点击“完成”完成FTP站点的创建。

### 三、配置防火墙

1. **打开端口21**
    - 确保服务器的防火墙允许通过TCP端口21的连接。
    - 打开“Windows防火墙”，选择“高级设置”，创建一个入站规则，允许TCP端口21的流量。

2. **配置被动模式端口（可选）**
    - 如果使用被动模式，需开放一系列端口供FTP使用。在IIS管理器中，选择FTP站点，双击“FTP防火墙支持”，设置“数据通道端口范围”，例如50000-51000。
    - 在防火墙中同样开放这些端口范围。

### 四、设置用户权限

1. **创建FTP用户**
    - 可以使用Windows本地用户或域用户。确保用户具有访问FTP物理路径文件夹的权限。

2. **设置文件夹权限**
    - 右键点击FTP物理路径文件夹，选择“属性” > “安全”。
    - 添加FTP用户，并赋予“读取”和“写入”权限。

### 五、测试FTP服务器

1. **使用FTP客户端连接**
    - 使用如FileZilla等FTP客户端，输入服务器的IP地址、用户名和密码，尝试连接。

2. **检查连接和传输**
    - 确认能够成功连接并上传/下载文件。

### 六、安全性建议

1. **使用FTPS**
    - 为了保证数据传输的安全性，建议配置FTP站点使用SSL/TLS加密，即FTPS。
    - 在IIS管理器中，为FTP站点绑定SSL证书，并在“FTP SSL设置”中配置相应选项。

2. **限制用户权限**
    - 仅给予用户必要的权限，避免不必要的访问。

3. **定期更新和监控**
    - 定期更新服务器和FTP软件，监控FTP日志，防范潜在的安全威胁。

### 七、常见问题排查

1. **无法连接到FTP服务器**
    - 检查FTP服务是否已启动。
    - 确认防火墙设置是否正确，端口21及被动模式端口是否开放。
    - 确认服务器IP和端口配置是否正确。

2. **登录失败**
    - 检查用户名和密码是否正确。
    - 确认用户有访问FTP物理路径的权限。

3. **传输速度慢或中断**
    - 检查网络连接是否稳定。
    - 确认防火墙和路由器设置是否影响传输。