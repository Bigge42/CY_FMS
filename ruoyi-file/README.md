以下是一份整理后的接口调用文档，涵盖文件上传、下载（附件方式）和在线预览三种接口的详细说明、请求参数、请求示例以及响应格式说明，方便前端开发和测试人员快速对接接口。

---

# FMS FTP 接口调用文档

**接口前缀：**
```
http://localhost:8088/fms/ftp
```

---

## 一、文件上传接口

### 1.1 接口说明

**用途：**
- 用于上传文件至 FTP 服务器。
- 上传流程包括：
  1. 将上传的文件保存到本地临时目录；
  2. 根据传入的 `documentTypeName` 查找或创建对应的文件夹记录；
  3. 调用 FTP 服务上传文件至对应目录，生成相对路径（例如 `"uploads/合格证/xxx_20250121155010.pdf"`）；
  4. 将生成的相对路径写入数据库的文件记录；
  5. 返回 JSON 响应，其中 `url` 字段为生成的相对路径（不包含 FTP 登录信息）。

### 1.2 请求信息

- **请求 URL：**
  ```
  POST http://localhost:8088/fms/ftp/upload
  ```
- **请求方式：**  
  POST
- **请求参数（form-data 类型）：**

  | 参数名称           | 类型   | 是否必传 | 说明                                               |
    |--------------------|--------|----------|----------------------------------------------------|
  | file               | File   | 是       | 上传的文件内容。                                   |
  | documentTypeName   | Text   | 是       | 文档类型名称。（示例："合格证"）                     |
  | matchID            | Text   | 是       | 匹配 ID，用于关联文件记录，例如 `123`。            |

### 1.3 请求示例

- **请求示例（在 Postman 中）：**

  | Key              | Type    | 示例值                          |
    |------------------|---------|---------------------------------|
  | file             | File    | 选择本地文件                    |
  | documentTypeName | Text    | 合格证                          |
  | matchID          | Text    | 123                             |

### 1.4 响应说明

- **成功响应示例：**

  ```json
  {
    "code": 200,
    "msg": "文件上传成功并已存储到数据库",
    "url": "uploads/合格证/xxx_20250121155010.pdf"
  }
  ```

- **失败响应示例：**

  ```json
  {
    "code": 500,
    "msg": "文件上传到 FTP 失败"
  }
  ```

---

## 二、文件下载接口

### 2.1 接口说明

**用途：**
- 用于下载文件，采用附件形式输出。
- 后端根据请求中的文件相对路径，从 FTP 服务器下载文件到本地临时目录，再通过 HTTP 文件流输出，触发浏览器下载提示。

### 2.2 请求信息

- **请求 URL：**
  ```
  GET http://localhost:8088/fms/ftp/download
  ```
- **请求方式：**  
  GET
- **请求参数（Query 参数）：**

  | 参数名称  | 类型   | 是否必传 | 说明                                                    |
    |-----------|--------|----------|---------------------------------------------------------|
  | filePath  | String | 是       | 文件在 FTP 上的相对路径，例如：`uploads/合格证/file.txt`。 |

### 2.3 请求示例

```
GET http://localhost:8088/fms/ftp/download?filePath=uploads/合格证/file.txt
```

### 2.4 响应说明

- **成功时：**
  - 后端将文件流输出至 HTTP 响应，响应头设置为：
    - `Content-Type: application/octet-stream`
    - `Content-Disposition: attachment`（附件下载，浏览器将弹出下载对话框）
- **失败时：**  
  返回 HTTP 错误状态码（如 404 或 500），响应体中包含错误提示信息，例如：

  ```json
  {
      "msg": "文件下载失败或不存在",
      "code": 404
  }
  ```

---

## 三、在线预览接口

### 3.1 接口说明

**用途：**
- 用于在线预览文件。
- 与下载接口类似，但响应头设置为内联展示（`Content-Disposition: inline`），并根据文件扩展名自动设置合适的 `Content-Type`（例如图片、PDF、文本等）。
- 预览时浏览器直接内嵌展示文件内容，而不弹出下载提示。

### 3.2 请求信息

- **请求 URL：**
  ```
  GET http://localhost:8088/fms/ftp/preview
  ```
- **请求方式：**  
  GET
- **请求参数（Query 参数）：**

  | 参数名称  | 类型   | 是否必传 | 说明                                                    |
    |-----------|--------|----------|---------------------------------------------------------|
  | filePath  | String | 是       | 文件在 FTP 上的相对路径，例如：`uploads/合格证/file.txt`。 |

### 3.3 请求示例

```
GET http://localhost:8088/fms/ftp/preview?filePath=uploads/合格证/file.txt
```

### 3.4 响应说明

- **成功时：**
  - 后端将文件流输出至 HTTP 响应，响应头设置为：
    - `Content-Type` 根据文件类型设定（例如 `image/png`、`application/pdf`、`text/plain` 等）；
    - `Content-Disposition: inline`，浏览器直接在页面中显示文件内容（或嵌入到 `<iframe>`、`<img>`、`<object>` 中）。
- **失败时：**  
  返回 HTTP 错误状态码（如 404 或 500），响应体中包含错误提示信息，例如：

  ```json
  {
      "msg": "文件下载失败或不存在",
      "code": 404
  }
  ```

---

## 四、前端使用说明

### 4.1 下载接口调用示例

- **描述：**  
  前端通过 GET 请求调用下载接口，浏览器会弹出保存文件对话框。
- **示例（URL）：**

  ```
  GET http://localhost:8088/fms/ftp/download?filePath=uploads/合格证/file.txt
  ```

- **使用提示：**
  - 在 Postman 中测试时，可以选择“Save Response”将返回的文件保存到本地。
  - 前端代码可直接调用该接口，或通过设置 `<a href="...">` 链接直接触发下载。

### 4.2 在线预览接口调用示例

- **描述：**  
  前端通过 GET 请求调用在线预览接口，浏览器根据响应头直接在页面内显示文件内容。
- **示例（使用 `<iframe>` 预览）：**

  ```html
  <iframe src="http://localhost:8088/fms/ftp/preview?filePath=uploads/合格证/file.txt" style="width:100%; height:600px;" frameborder="0"></iframe>
  ```

- **使用提示：**
  - 针对图片可使用 `<img>` 标签；PDF 文件可使用 `<iframe>` 或 `<object>` 标签嵌入预览。
  - 前端开发者需根据文件类型及显示需求选择合适的标签和样式。

---
